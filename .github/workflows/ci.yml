# NetSec Toolkit â€“ run Core, Cloud, Container tests in parallel
name: NetSec Toolkit CI

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

# Fail the workflow if any job fails
jobs:
  test-core:
    name: NetSec-Core
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: netsec-core
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install
        run: pip install -e ".[dev]"
      - name: Pytest
        run: pytest -v -m "not integration" --tb=short
      - name: Lint
        run: ruff check src/ tests/ || true
      - name: Pip-audit (optional)
        run: pip install pip-audit && pip-audit --skip-editable || true

  test-cloud:
    name: NetSec-Cloud
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: netsec-cloud
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install
        run: pip install -e ".[dev]"
      - name: Pytest
        run: pytest -v -m "not integration" --tb=short
      - name: Lint
        run: ruff check src/ tests/ || true
      - name: Pip-audit (optional)
        run: pip install pip-audit && pip-audit --skip-editable || true

  test-container:
    name: NetSec-Container
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: netsec-container
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install
        run: pip install -e ".[dev]"
      - name: Pytest
        run: pytest -v -m "not integration" --tb=short
      - name: Lint
        run: ruff check src/ tests/ || true
      - name: Pip-audit (optional)
        run: pip install pip-audit && pip-audit --skip-editable || true

"""Unit tests for BasicVulnerabilityScanner (no image)."""

import pytest
from netsec_container.core.vulnerability_basic import BasicVulnerabilityScanner


@pytest.mark.unit
def test_basic_vuln_scanner_init():
    """BasicVulnerabilityScanner initializes."""
    scanner = BasicVulnerabilityScanner()
    assert scanner is not None
    assert scanner.name == "Basic Vulnerability Scanner"
    assert "dpkg" in scanner.package_managers
    assert "pip" in scanner.package_managers
    assert scanner.enable_osv_lookup is True


@pytest.mark.unit
def test_basic_vuln_scanner_init_osv_disabled():
    """BasicVulnerabilityScanner can disable OSV lookup."""
    scanner = BasicVulnerabilityScanner(enable_osv_lookup=False)
    assert scanner.enable_osv_lookup is False


@pytest.mark.unit
@pytest.mark.asyncio
async def test_query_osv_unknown_ecosystem_returns_empty():
    """_query_osv returns empty list for unknown manager/ecosystem."""
    scanner = BasicVulnerabilityScanner(enable_osv_lookup=True)
    result = await scanner._query_osv("somepkg", "1.0", "unknown_manager")
    assert result == []